{{ define "main" }}
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <ul class="event-list">
          {{ range sort .Site.Data.meetups.list "from" }}
            {{ if ge (time .from) (now.AddDate 0 0 -1) }}
              <li class="event-entry list-group-item d-flex justify-content-between align-items-center"
                style="margin: 10px; border-radius: 15px">
                {{ if eq (printf "%T" .tags) "[]interface {}" }}
                  {{ range .tags }}
                  <span class="badge badge-primary" style="font-weight: normal; background: cornflowerblue">{{ . }}</span>
                  {{ end }}
                {{ else }}
                  <span class="badge badge-primary" style="font-weight: normal; background: cornflowerblue">{{ .tags }}</span>
                {{ end}}
                <p>
                  <h3 class="name card-title">{{ .name }}</h3>
                  <h4 class="details card-subtitle text-muted"><span class="human-date">{{ .from }}</span>, {{ .venue }}</h4>
                  <a class="address" href="{{ .map }}" target="_blank">{{ .address }}</a>
                </p>
                <div class="btn-group" role="group">
                  {{ if .address }}
                    <a href="{{ .map }}" target="_blank" class="btn btn-primary">Map</a>
                  {{ end }}

                  <span class="add-to-google-calendar">
                    {{ if .dates }}
                      <a class="btn btn-primary"
                        href='https://www.google.com/calendar/render?action=TEMPLATE&text={{ .name }}&dates={{ .dates }}&details=Event+page+link:+{{ .link }}&location={{ .address }}&sf=true&output=xml'
                        target="_blank">Add to calendar
                      </a>
                    {{ else }}
                    {{ end }}
                  </span>
                <a class="event-link btn btn-primary" href="{{ .link }}" target="_blank">Event page</a>
                </div>
              </li>
            {{ end }}
          {{ end }}
        </ul>

        {{ .Content }}

          <div id="new-meetup-form">
            <form method="POST" action="{{ .Site.Params.staticman_api }}">
              <input name="options[redirect]" type="hidden" value="{{ .Permalink }}#post-submitted">
              <input name="options[redirectError]" type="hidden" value="{{ .Permalink }}#post-submitted">
              <div class="form-group">
                <label for="eventName">Event Name</label>
                <input class="form-control" id="eventName" name="fields[name]" type="text" placeholder="RubyConf MY 2018">
              </div>
              <div class="row">
                <div class="form-group col-sm-6">
                  <label for="eventStart">Event Start</label>
                  <input class="flatpickr form-control" id="eventStart" name="fields[from]" type="text" placeholder="Select Date ...">
                </div>
                <div class="form-group col-sm-6">
                  <label for="eventEnd">Event End</label>
                  <input class="flatpickr form-control" id="eventEnd" name="fields[to]" type="text" placeholder="Select Date ...">
                </div>
              </div>
              <div class="row">
                <div class="form-group col-sm-6">
                  <label for="venue">Venue</label>
                  <input class="form-control" id="venue" name="fields[venue]" type="text" placeholder="Suria Labs">
                </div>
                <div class="form-group col-sm-6">
                  <label for="map">Map Link</label>
                  <input class="form-control" id="map" name="fields[map]" type="text" placeholder="https://goo.gl/maps/ik9uWtxxKs52">
                </div>
              </div>
              <div class="form-group">
                <label for="address">Address</label>
                <input class="form-control" id="address" name="fields[address]" type="text" placeholder="B-12-6, Level 12, Tower B, Vertical Office Suites, Jalan Kerinchi, Bangsar South Kuala Lumpur, Malaysia">
              </div>
              <div class="row">
                <div class="form-group col-sm-6">
                    <label for="venue">Event link</label>
                    <input class="form-control" id="link" name="fields[link]" type="text" placeholder="Suria Labs">
                  </div>
                  <div class="form-group col-sm-6">
                    <label for="tags">Tag</label>
                    <input class="form-control" id="tags" name="fields[tags]" type="text" placeholder="Ruby">
                  </div>
                </div>
              <button type="submit" class="btn btn-primary">Submit</button>
            </form>
          </div>


        <script>
          flatpickr(".flatpickr", {
            enableTime: true,
            dateFormat: "Z",
            altInput: true,
            altFormat: "F j, Y h:iK",
          });

          var content = document.getElementsByClassName("blog-post")[0];
          var links = content.getElementsByTagName("a");

          for (var i = 0, linksLength = links.length; i < linksLength; i++) {
             if (links[i].hostname != window.location.hostname) {
                links[i].target = '_blank';
             }
          }

          var humanDates = document.querySelectorAll(".human-date");
          for (var i = 0; i < humanDates.length; i++) {
            var stringDate = humanDates[i].textContent;
            humanDates[i].textContent = ((new Date(stringDate)).toLocaleDateString('en-GB', {
              weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
            }))
          }
        </script>


        {{ if .Params.tags }}
          <div class="blog-tags">
            {{ range .Params.tags }}
              <a href="{{ $.Site.LanguagePrefix | absURL }}/tags/{{ . | urlize }}/">{{ . }}</a>&nbsp;
            {{ end }}
          </div>
        {{ end }}

        {{ if .Site.Params.socialShare }}
          <hr/>
          <section id="social-share">
            <ul class="list-inline footer-links">
              {{ partial "share-links" . }}
            </ul>
          </section>
        {{ end }}
      </article>

      {{ if (.Params.comments) | or (and (or (not (isset .Params "comments")) (eq .Params.comments nil)) (and .Site.Params.comments (ne .Type "page"))) }}
        {{ if .Site.DisqusShortname }}
          <div class="disqus-comments">
            {{ template "_internal/disqus.html" . }}
          </div>
        {{ end }}
        {{ if .Site.Params.staticman }}
          <div class="staticman-comments">
            {{ partial "staticman-comments.html" . }}
          </div>
        {{ end }}
      {{ end }}

    </div>
  </div>
</div>
{{ end }}
